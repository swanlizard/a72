		MOV AH, 9
		MOV DX, OFFSET AMSG
		INT 21H
		MOV AH, 30H
		INT 21H
		OR AL, AL
		JNZ MAIN
		MOV AH, 9
		MOV DX, OFFSET DOSERR
		INT 21H
		RET
MAIN:		MOV SI, 80H
		CLD
		LODSB
		XOR AH, AH
		MOV CX, AX
		ADD CX, SI
		MOV DI, OFFSET INFN
		CALL GETFN
		JC CMDL0
		MOV AL, 1
		MOV [FUNC], AL
		MOV AX, [INFN]
		MOV DX, OFFSET DOTASM
		MOV BX, OFFSET DOTCOM
		CMP AX, 412FH
		JZ CMDASM
		CMP AX, 442FH
		JZ CMDDIS
		CMP AX, 542FH
		JNZ CMDDET
		CALL INIT
		MOV [FUNC], AL
		CALL ASM
		JC CMDTRE
		XOR AX, AX
		MOV [PC], AX
		MOV SI, OFFSET OUTPUT
		MOV DI, OFFSET ELEMENT
		CALL DISASM
CMDTRE:		MOV SI, OFFSET ELEMENT
		CALL STOP
		RET
CMDL0:		MOV AH, 9
		MOV DX, OFFSET USAGE
		INT 21H
		RET
CMDDIS:		MOV AL, 3
		MOV [FUNC], AL
		XCHG DX, BX
CMDASM:		MOV DI, OFFSET INFN
		CALL GETFN
		JC CMDL0
CMDDET:		MOV DI, OFFSET OUTFN
		CALL GETFN
		JNC CMDGOT
		MOV CX, 40H
		MOV SI, OFFSET INFN
		MOV DI, OFFSET OUTFN
		PUSH DI
	REPZ	MOVSB
		POP DI
		STC
		CALL ADDEXT
CMDGOT:		MOV SI, DX
		MOV DI, OFFSET INFN
		CLC
		CALL ADDEXT
		MOV SI, BX
		MOV DI, OFFSET OUTFN
		CLC
		CALL ADDEXT
		CALL OPENF
		JC CMDX
		MOV SI, OFFSET PROCM
		CALL STOP
		MOV SI, OFFSET INFN
		CALL OUTF
		MOV AL, [FUNC]
		CMP AL, 1
		JZ DOASM
		CALL DISF
		JMP SHORT OUTGEN
DOASM:		CALL ASMF
		JC PERR
		INC BYTE PTR [FUNC]
		CALL ASMF
		JC PERR
OUTGEN:		MOV SI, OFFSET OUTM
		CALL STOP
		MOV SI, OFFSET OUTFN
		CALL OUTF
PERR:		CALL CLOSF
		MOV AX, [ERRS]
		OR AX, AX
		JZ CMDX
		MOV DI, OFFSET ERRN
		CALL WDA
		MOV AH, 9
		MOV DX, OFFSET ERRF
		INT 21H
		MOV AH, 41H
		MOV DX, OFFSET OUTFN
		INT 21H
CMDX:		RET
