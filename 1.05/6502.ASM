ASM:	MOV	[STK],SP
	XOR	AX,AX
	MOV	[BINLEN],AX
	MOV	SI,[TXTBUF]
	MOV	AL,[FUNC]
	TEST	AL,AL
	JNS	ASMLIN
	XOR	AX,AX
	MOV	[TXTLEN],AX
	MOV	SI,[BINBUF]
	MOV	DI,[TXTBUF]
	CALL	DISASM
	MOV	AX,0A0DH
	STOSW
	MOV	[BINLEN],CX
	ADD	[PC],CX
	MOV	AX,DI
	SUB	AX,[TXTBUF]
	MOV	[TXTLEN],AX
	CLC
	RET
ASMLBL:	CALL	LBL
ASMLIN:	CALL	CC
	JZ	ASMEND
	CMP	AL,2AH
	JZ	ASMPC
	CMP	AL,3DH
	JZ	ASMEQU
	CALL	CM
	JNZ	ASMLBL
	CALL	DIRS
	JNC	ASMLNE
	MOV	BX,64
ASMRMN:	DEC	BX
	JS	ASMLBL
	CMP	DH,[BX+MNEML]
	JNZ	ASMRMN
	CMP	DL,[BX+MNEMR]
	JNZ	ASMRMN
	ADD	SI,3
	PUSH	DX
	CALL	RA
	POP	DX
	MOV	CX,BX
	XOR	AX,AX
	CALL	SCAN
	CLD
	MOV	DI,[BINBUF]
	STOSB
	MOV	AX,[IMM]
	STOSW
	MOV	CL,CH
	AND	CX,3
	MOV	[BINLEN],CX
	ADD	[PC],CX
ASMLNE:	CALL	CC
	JZ	ASMEND
	MOV	AL,9
	JMP	FAIL
ASMEND:	CLC
	RET
ASMPC:	INC	SI
	CALL	CC
	JZ	ASMER1
	CMP	AL,3DH
	JNZ	ASMER1
	INC	SI
	CALL	RI
	TEST	DH,1
	JZ	ASMAPC
	SUB	AX,[VORG]
	SUB	AX,[PC]
	JBE	ASMAPC
	ADD	[USIZE],AX
	ADD	[PC],AX
	CLC
	RET
ASMAPC:	MOV	[PC],AX
	CLC
	RET
ASMER1:	MOV	AL,1
	JMP	FAIL
ASMEQU:	INC	SI
	JMP	SETEQU
CM:	CMP	BL,3
	JNZ	CMX
	XOR	DX,DX
	DEC	BX
CMA:	MOV	CX,5
	MOV	AL,[BX+SI]
	SUB	AL,40H
CMB:	ROR	AL,1
	RCR	DX,1
	LOOP	CMB
	DEC	BX
	JNS	CMA
	XOR	AL,AL
CMX:	RET
SCAN:	PUSH	AX
	AND	AL,3
	CMP	AL,3
	POP	AX
	JZ	SCAN1
	CALL	MNEM
	XCHG	AL,AH
	CMP	DH,[BX+MNEML]
	JNZ	SCAN1
	CMP	DL,[BX+MNEMR]
	JNZ	SCAN1
	CMP	AH,CL
	JZ	SCAN0
	CMP	AL,4CH
	JZ	SCAN2
	CMP	AL,20H
	JZ	SCAN2
	CMP	AH,09H
	JZ	SCAN4
	CMP	AH,0AH
	JZ	SCAN6
	CMP	AH,0CH
	JZ	SCAN7
	CMP	CL,0DH
	JNZ	SCAN1
	CMP	AH,06H
	JZ	SCAN3
SCAN6:	CMP	CL,08H
	JZ	SCAN0
SCAN1:	INC	AL
	JNZ	SCAN
ERR2:	MOV	AL,2
	JMP	FAIL
ERR5:	MOV	AL,5
	JMP	FAIL
SCAN2:	CMP	CL,1
	JNZ	SCAN1
SCAN3:	MOV	CH,3
	RET
SCAN4:	CMP	CL,1
	JNZ	ERR2
	MOV	AL,[IMM]
	MOV	CH,1
	RET
SCAN7:	PUSH	AX
	MOV	AX,[IMM]
	SUB	AX,[PC]
	SUB	AX,[VORG]
	SUB	AX,2
	MOV	[IMM],AX
	MOV	CH,2
	CALL	AA
	POP	AX
	JC	ERR5
SCAN0:	RET
DIRS:	MOV	BX,8
DIRS1:	DEC	BX
	JS	DIRS0
	CMP	DH,[BX+DIRML]
	JNZ	DIRS1
	CMP	DL,[BX+DIRMR]
	JNZ	DIRS1
	MOV	[OPCODE],BL	
	SHL	BX,1
	ADD	SI,3
	JMP	[BX+AHDL]
DIRS0:	STC
	RET
D5:	MOV	AL,0FFH
	JMP	FAIL
D6:	MOV	AL,4
	SUB	AL,[OPCODE]
	MOV	[OPCODE],AL
	JMP	SETINC
RA:	MOV	CH,1
	CALL	CC
	JZ	RAE
	MOV	CH,0
	CMP	BL,1
	JNZ	RAC
	MOV	AH,42H
	CMP	AL,23H
	JZ	RAB
	MOV	AH,20H
	CMP	AL,28H
	JZ	RAB
	MOV	CL,81H
	CMP	AL,41H
	JNZ	RAC
	INC	SI
	JMP	SHORT RAE
RAB:	MOV	CH,AH
	INC	SI
RAC:	CALL	RI
	CALL	CC
	JZ	RAE
	CALL	COMMA
	JNZ	RAD
	OR	CH,AH
	CALL	CC
	JZ	RAE
RAD:	CMP	AL,29H
	JNZ	RA1
	INC	SI
	OR	CH,8
	TEST	CH,4
	JNZ	RA6
	CALL	CC
	JZ	RAE
	CALL	COMMA
	JNZ	RA1
	OR	CH,AH
	TEST	CH,8
	JZ	RAE
	CMP	AL,58H
	JZ	RA6
RAE:	OR	CH,CL
	MOV	AL,CH
	CMP	AL,3BH
	JZ	RAF
	CMP	AL,2FH
	JZ	RAF
	CMP	AL,43H
	JNZ	RAH
RAF:	MOV	AL,[FUNC]
	AND	AL,2
	JZ	RAG
	MOV	AX,[IMM]
	TEST	AH,AH
	JZ	RAG
	CALL	AA
	JC	RA7
RAG:	MOV	AL,CH
	AND	AL,0FEH
RAH:	CMP	AL,2AH
	JNZ	RAI
	OR	AL,1
RAI:	MOV	BX,13
RAK:	CMP	AL,[BX+MODE]
	JZ	RAL
	DEC	BX
	JNS	RAK
	JS	RA2
RAL:	MOV	BH,AL
	CLC
	RET
RA1:	MOV	AL,1
	JMP	FAIL
RA2:	MOV	AL,2
	JMP	FAIL
RA6:	MOV	AL,0DH
	JMP	FAIL
RA7:	MOV	AL,7
	JMP	FAIL
RA8:	MOV	AL,8
	JMP	FAIL
COMMA:	CMP	AL,2CH
	JNZ	COMMA0
	INC	SI
	CALL	CC
	JZ	RA8
	CMP	BL,1
	JNZ	RA1
	INC	SI
	MOV	AH,10H
	CMP	AL,58H
	JZ	COMMA0
	MOV	AH,4
	CMP	AL,59H
	JNZ	RA1
COMMA0:	RET
RI:	MOV	DL,2AH
	CALL	RE
	MOV	DH,CL
	TEST	CL,13H
	JNZ	RIWO
	TEST	AH,AH
	JZ	RILB
RIWO:	MOV	CL,3
	RET
RILB:	MOV	CL,2
	RET
RNC:	PUSH	CX
	MOV	CL,5
	CMP	AL,24H
	JZ	RNC16
	CMP	AL,40H
	JZ	RNC8
	CMP	AL,25H
	JZ	RNC2
	CMP	AL,30H
	JC	RNC0
	CMP	AL,3AH
	JC	RNC10
RNC0:	POP	CX
	STC
	RET
RNC2:	DEC	CX
RNC4:	DEC	CX
RNC8:	DEC	CX
RNC16:	DEC	CX
	INC	SI
	CALL	CC
	JZ	RNM8
RNC10:	PUSH	AX
	PUSH	BX
	PUSH	SI
	CALL	RN
	POP	SI
	POP	BX
	POP	AX
	JNZ	RNC0
	POP	CX
	ADD	SI,BX
	CLC
	RET
RNM8:	MOV	AL,8
	JMP	FAIL
RNM:	MOV	AH,4
	CMP	AL,3CH
	JZ	RNM1
	MOV	AH,8
	CMP	AL,3EH
	JZ	RNM1
	MOV	AH,10H
	CMP	AL,21H
	JZ	RNM1
	STC
	RET
RNM1:	OR	CL,AH
	INC	SI
	CALL	CC
	JZ	RNM8
	CLC
	RET
DISASM:	CLD
	MOV	AL,[SI]
	MOV	DX,[SI+1]
	PUSH	DX
	CALL	MNEM
	PUSH	AX
	MOV	DH,[MNEML+BX]
	MOV	DL,[MNEMR+BX]
	MOV	BX,3
WMN1:	MOV	CX,5
WMN2:	ROL	DX,1
	RCL	AL,1
	LOOP	WMN2
	AND	AL,1FH
	ADD	AL,40H
	STOSB
	DEC	BX
	JNZ	WMN1
	POP	BX
	MOV	CH,BH
	XOR	BH,BH
	MOV	CL,[BX+MODE]
	POP	DX
	CMP	CL,1
	JZ	UNRAE
	MOV	AL,9
	STOSB
	MOV	AL,CL
	CMP	AL,55H
	JZ	INVD
	CMP	AL,0AAH
	JZ	RELD
	MOV	BL,5
	MOV	CH,CL
	AND	CL,3
UNRAA:	SHL	CH,1
	JNC	UNRAB
	MOV	AL,[CHAR1+BX]
	STOSB
	MOV	AL,[CHAR2+BX]
	TEST	AL,AL
	JZ	UNRAB
	STOSB
UNRAB:	CMP	BL,3
	JNZ	UNRAD
	CMP	CL,2
	JC	UNRAD
	MOV	AL,24H
	STOSB
	CMP	CL,3
	JC	UNRAC
	MOV	AL,DH
	CALL	HALX
UNRAC:	MOV	AL,DL
	CALL	HALX
UNRAD:	DEC	BX
	JNS	UNRAA
UNRAE:	XOR	CH,CH
	RET
INVD:	MOV	AL,24H
	STOSB
	MOV	AL,CH
	CALL	HALX
	MOV	CX,1
	RET
RELD:	MOV	AL,24H
	STOSB
	MOV	AL,DL
	CBW
	ADD	AX,2
	ADD	AX,[PC]
	ADD	AX,[VORG]
	XCHG	AX,DX
	MOV	AL,DH
	CALL	HALX
	MOV	AL,DL
	CALL	HALX
	MOV	CX,2
	RET
MNEM:	XOR	BH,BH
	MOV	AH,AL
	SHR	AL,1
	JNC	ASLD
	RCR	AL,1
	JC	INVI
	CMP	AL,0A2H
	JZ	INVI
	AND	AL,87H
ASLD:	SHR	AL,1
	MOV	BL,AL
	MOV	AL,[DGRP+BX]
	JC	$+0AH
	SHR	AL,1
	SHR	AL,1
	SHR	AL,1
	SHR	AL,1
	AND	AL,0FH
	CMP	AL,9
	JNZ	GMNM
INVI:	MOV	AL,9
	MOV	BL,10H
	RET
GMNM:	PUSH	AX
	MOV	AL,AH
	MOV	BL,3
	AND	AH,8FH
	CMP	AH,8AH
	JZ	TXAD
DFBD:	SHR	AL,1
	JNC	TXAD
	SHR	AL,1
BRKD:	SHR	AL,1
	OR	AL,20H
	DEC	BX
	JNZ	BRKD
	INC	BX
TXAD:	DEC	BX
	JNZ	DFBD
	MOV	BL,AL
	POP	AX
	RET
AHDL:	DW	SETDFS,SETDFB
	DW	SETDFB,SETEQU
	DW	SETORG,D5,D6,D6
DIRML:	DB	21H,21H,21H,2CH
	DB	7CH,2BH,0CH,12H
DIRMR:	DB	0A6H,84H,0AEH,6AH
	DB	8EH,88H,20H,5CH
CHAR1:	DB	2CH,29H,2CH
	DB	28H,23H,41H
CHAR2:	DB	59H,00H,58H
	DB	00H,00H,00H
MODE:	DB	3AH,02H,42H,03H
	DB	2EH,12H,07H,13H
	DB	01H,55H,81H,2BH
	DB	0AAH,06H
DGRP:	DB	89H,91H,8AH,93H
	DB	0C9H,95H,89H,97H
	DB	39H,11H,8AH,33H
	DB	0C9H,95H,89H,97H
	DB	89H,91H,8AH,33H
	DB	0C9H,95H,89H,97H
	DB	89H,91H,8AH,0B3H
	DB	0C9H,95H,89H,97H
	DB	99H,11H,88H,33H
	DB	0C9H,5DH,88H,99H
	DB	22H,11H,88H,33H
	DB	0C9H,5DH,88H,76H
	DB	29H,11H,88H,33H
	DB	0C9H,95H,89H,97H
	DB	29H,11H,88H,33H
	DB	0C9H,95H,89H,97H
	DB	01H,23H,45H,67H
MNEML:	DB	14H,82H,14H,1BH
	DB	54H,83H,13H,99H
	DB	95H,82H,15H,1BH
	DB	95H,83H,15H,99H
	DB	21H,21H,10H,0A6H
	DB	61H,0A0H,10H,1BH
	DB	1CH,4BH,13H,1BH
	DB	1CH,4BH,11H,99H
	DB	21H,12H,53H,53H
	DB	9DH,61H,1CH,1CH
	DB	0A6H,0A6H,0A0H,0A4H
	DB	21H,21H,73H,21H
	DB	0CH,93H,64H,93H
	DB	9DH,61H,21H,4BH
	DB	7CH,0BH,2BH,09H
	DB	9DH,61H,1BH,98H
MNEMR:	DB	96H,20H,18H,06H
	DB	0E4H,20H,52H,46H
	DB	12H,02H,86H,12H
	DB	26H,02H,0A6H,52H
	DB	84H,72H,0C6H,42H
	DB	32H,72H,0E6H,2CH
	DB	32H,0B2H,8AH,08H
	DB	30H,0B0H,62H,48H
	DB	84H,68H,60H,60H
	DB	32H,32H,32H,30H
	DB	02H,26H,70H,0F0H
	DB	70H,84H,0E0H,84H
	DB	0D8H,0D8H,0E4H,0E4H
	DB	30H,30H,46H,86H
	DB	82H,88H,0E4H,06H
	DB	02H,02H,60H,86H
